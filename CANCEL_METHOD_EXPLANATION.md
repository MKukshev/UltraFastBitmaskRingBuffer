# –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ—Ç–æ–¥ `cancel()` –≤ —Å–∏—Å—Ç–µ–º–µ –∑–∞–¥–∞—á

## üéØ **–û–±–∑–æ—Ä –º–µ—Ö–∞–Ω–∏–∑–º–∞ –æ—Ç–º–µ–Ω—ã**

–ú–µ—Ç–æ–¥ `cancel()` —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –æ—Ç–º–µ–Ω—É –∑–∞–¥–∞—á** (cooperative cancellation), —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∑–∞–¥–∞—á–∞ —Å–∞–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–ª–∞–≥ –æ—Ç–º–µ–Ω—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É.

## üîß **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–º–µ–Ω—ã**

### **1. –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–º–µ–Ω—ã**
```java
protected volatile boolean isCancelled = false;
```
- `volatile` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
- –§–ª–∞–≥ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `true` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `cancel()`

### **2. –°—á–µ—Ç—á–∏–∫ –æ—Ç–º–µ–Ω**
```java
protected final AtomicLong cancellationCount = new AtomicLong(0);
```
- –ê—Ç–æ–º–∞—Ä–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–º–µ–Ω
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## üìã **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ `cancel()`**

```java
public final void cancel() {
    if (!isCancelled && !isCompleted) {
        isCancelled = true;
        cancellationCount.incrementAndGet();
        logInfo("Task cancelled: " + taskName);
    }
}
```

### **–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è** - –æ—Ç–º–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ –æ—Ç–º–µ–Ω–µ–Ω–∞ –∏ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞** - `isCancelled = true`
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –æ—Ç–º–µ–Ω
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏—è –æ—Ç–º–µ–Ω—ã

## üîÑ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º**

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º**
```java
public final void executeWithExceptionHandling() {
    if (isCancelled) {
        logWarning("Task cancelled before execution: " + taskName);
        return;
    }
    // ... –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
}
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
```java
@Override
public void execute() {
    executionCount++;
    logInfo("Starting execution: " + data + " (local count: " + executionCount + ")");
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–º–µ–Ω—É –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    if (isCancelled()) {
        logWarning("Task cancelled during execution: " + data);
        return;
    }
    
    // ... –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–¥–∞—á–∏
}
```

## üé≠ **–°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

### **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –û—Ç–º–µ–Ω–∞ –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
```java
SimpleTask task = pool.getFreeObject();
task.cancel(); // –û—Ç–º–µ–Ω—è–µ–º –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
task.executeWithExceptionHandling(); // –ó–∞–¥–∞—á–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
// –†–µ–∑—É–ª—å—Ç–∞—Ç: "Task cancelled before execution"
```

### **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—Ç–º–µ–Ω–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
```java
SimpleTask task = pool.getFreeObject();
task.setSimulateCancellation(true); // –í–∫–ª—é—á–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é –æ—Ç–º–µ–Ω—ã
task.executeWithExceptionHandling(); // –ó–∞–¥–∞—á–∞ –æ—Ç–º–µ–Ω–∏—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
// –†–µ–∑—É–ª—å—Ç–∞—Ç: "Task cancelled during execution"
```

### **–°—Ü–µ–Ω–∞—Ä–∏–π 3: –í–Ω–µ—à–Ω—è—è –æ—Ç–º–µ–Ω–∞**
```java
SimpleTask task = pool.getFreeObject();
// –ó–∞–ø—É—Å–∫–∞–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
executor.submit(() -> task.executeWithExceptionHandling());

// –û—Ç–º–µ–Ω—è–µ–º –∏–∑ –¥—Ä—É–≥–æ–≥–æ –ø–æ—Ç–æ–∫–∞
task.cancel();
```

## üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ç–º–µ–Ω—ã**

### **–ú–µ—Ç–æ–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```java
public final boolean isCancelled() {
    return isCancelled;
}

public final String getStatus() {
    if (isCancelled) return "CANCELLED";
    if (hasException) return "FAILED";
    if (isCompleted) return "COMPLETED";
    return "PENDING";
}

public final long getCancellationCount() {
    return cancellationCount.get();
}
```

## ‚ö° **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**

### **1. –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –æ—Ç–º–µ–Ω–∞**
- –ó–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ —Å–∞–º–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–ª–∞–≥ –æ—Ç–º–µ–Ω—ã
- –ù–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã

### **2. –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- `volatile` –¥–ª—è —Ñ–ª–∞–≥–∞ –æ—Ç–º–µ–Ω—ã
- `AtomicLong` –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ

### **3. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `cancel()` –±–µ–∑–æ–ø–∞—Å–Ω—ã
- –§–ª–∞–≥ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- –°—á–µ—Ç—á–∏–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—Ç–º–µ–Ω–µ

### **4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –í—Å–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç–º–µ–Ω—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–∏–º—è –∑–∞–¥–∞—á–∏)
- –†–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## üö® **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**

### **1. –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å**
```java
// ‚ùå –ü–ª–æ—Ö–æ - –∑–∞–¥–∞—á–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–º–µ–Ω—É
public void execute() {
    while (true) {
        // –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–º–µ–Ω—ã
        doWork();
    }
}

// ‚úÖ –•–æ—Ä–æ—à–æ - –∑–∞–¥–∞—á–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–º–µ–Ω—É
public void execute() {
    while (!isCancelled()) {
        doWork();
    }
}
```

### **2. –ù–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏**
- –ù–µ–ª—å–∑—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ó–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ —Å–∞–º–∞ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –æ—Ç–º–µ–Ω—É
- –î–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–ª–∞–≥

## üìä **–ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ç–µ—Å—Ç–æ–≤**

### **–ü—Ä–∏–º–µ—Ä 1: –û—Ç–º–µ–Ω–∞ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ**
```java
// –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–¥–∞—á–∏
for (int i = 0; i < 3; i++) {
    executor.submit(() -> {
        SimpleTask task = pool.getFreeObject();
        task.executeWithExceptionHandling();
        pool.setFreeObject(task);
    });
}

// –û—Ç–º–µ–Ω—è–µ–º –≤—Å–µ –∑–∞–¥–∞—á–∏ –≤ –ø—É–ª–µ
for (int i = 0; i < 3; i++) {
    SimpleTask task = pool.getFreeObject();
    if (task != null) {
        task.cancel();
        pool.setFreeObject(task);
    }
}
```

### **–ü—Ä–∏–º–µ—Ä 2: –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–º–µ–Ω—ã**
```java
SimpleTask task = pool.getFreeObject();
task.setSimulateCancellation(true); // –í–∫–ª—é—á–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é
task.executeWithExceptionHandling(); // –ó–∞–¥–∞—á–∞ –æ—Ç–º–µ–Ω–∏—Ç—Å—è —Å–∞–º–∞
```

## üéØ **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**

### **1. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**
```java
public void execute() {
    for (int i = 0; i < 1000; i++) {
        if (isCancelled()) {
            logInfo("Task cancelled at iteration " + i);
            return;
        }
        doWork(i);
    }
}
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–æ—á–∫–∞—Ö**
```java
public void execute() {
    if (isCancelled()) return;
    
    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    prepareData();
    
    if (isCancelled()) return;
    
    // –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞
    processData();
    
    if (isCancelled()) return;
    
    // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
    cleanup();
}
```

### **3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**
```java
public void execute() {
    while (!isCancelled()) {
        try {
            // –ë–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —Å —Ç–∞–π–º–∞—É—Ç–æ–º
            if (blockingOperation(100)) {
                break;
            }
        } catch (InterruptedException e) {
            if (isCancelled()) {
                Thread.currentThread().interrupt();
                return;
            }
        }
    }
}
```

## üöÄ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

–ú–µ—Ç–æ–¥ `cancel()` —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—ç–ª–µ–≥–∞–Ω—Ç–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–º–µ–Ω—ã –∑–∞–¥–∞—á**:

- ‚úÖ **–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –æ—Ç–º–µ–Ω–∞** - –∑–∞–¥–∞—á–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç —Ä–∞–±–æ—Ç—É
- ‚úÖ **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ
- ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–º–µ–Ω
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
- ‚úÖ **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã

–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–Ω–∞–¥–µ–∂–Ω—É—é –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—É—é –æ—Ç–º–µ–Ω—É –∑–∞–¥–∞—á** –≤ production-—Å—Ä–µ–¥–µ! üéâ 