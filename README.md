# UltraFast Bitmask Ring Buffer

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–ª—å—Ü–µ–≤–æ–≥–æ –±—É—Ñ–µ—Ä–∞ —Å –±–∏—Ç–æ–≤—ã–º–∏ –º–∞—Å–∫–∞–º–∏ –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π —Å—Ä–µ–¥—ã –Ω–∞ Java. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å –ø—É–ª–æ–º –æ–±—ä–µ–∫—Ç–æ–≤.

## üöÄ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (v2.0)

### –ù–æ–≤—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—É–ª–æ–≤
- **BitmaskRingBufferUltraVarHandle** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å VarHandle
- **BitmaskRingBufferClassicPreallocated** - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –≤–µ—Ä—Å–∏—è —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–º —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–æ–≤
- **BitmaskRingBufferMinimal** - –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å Unsafe

### Thread Safety —É–ª—É—á—à–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ BitmaskRingBufferClassic
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã race conditions –≤ acquire/release –º–µ—Ç–æ–¥–∞—Ö
- –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ thread safety –≤—Å–µ—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑
- **GCMemoryTest** - —Ç–µ—Å—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∞–ª–ª–æ–∫–∞—Ü–∏–π GC –º–µ–∂–¥—É –ø—É–ª–∞–º–∏ (5 –º–∏–Ω—É—Ç)
- **ThreadSafetyAnalysis** - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ thread safety
- **PoolSizeComparison** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–∞—Ö
- **MemoryBenchmark** - –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ GC (5 –º–∏–Ω—É—Ç –Ω–∞–≥—Ä—É–∑–∫–∏)
| –ú–µ—Ç—Ä–∏–∫–∞ | UltraVarHandle | Classic | –†–∞–∑–Ω–∏—Ü–∞ |
|---------|----------------|---------|---------|
| –û–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫ | 3,124,342 | 3,017,853 | +3.5% |
| –í—Ä–µ–º—è acquire (–Ω—Å) | 412 | 521 | -21% |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ GC | **0** | **433** | **+‚àû** |
| –í—Ä–µ–º—è GC (–º—Å) | **0** | **218** | **+‚àû** |

**–ö–ª—é—á–µ–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: UltraVarHandle –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–Ω—É–ª–µ–≤—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã GC**!

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **Lock-free –∞–ª–≥–æ—Ä–∏—Ç–º—ã**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ë–∏—Ç–æ–≤—ã–µ –º–∞—Å–∫–∏**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ (64 –±–∏—Ç–∞ –Ω–∞ long)
- **–ö–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –¥–æ —Å—Ç–µ–ø–µ–Ω–∏ 2
- **–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å**: –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- **CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤, –Ω–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–Ω—ã—Ö –≤ –ø—É–ª
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—É–ª–∞
- **Thread Safety**: –ü–æ–ª–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ —Å –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—É–ª–æ–≤

1. **BitmaskRingBufferUltraVarHandle<T>** - —Å–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç VarHandle –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤
   - –ù—É–ª–µ–≤—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã GC
   - –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å acquire

2. **BitmaskRingBufferClassic<T>** - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
   - –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è thread safety
   - –ú–µ–Ω—å—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
   - –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å release

3. **BitmaskRingBufferClassicPreallocated<T>** - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å –ø—Ä–µ–¥—Å–æ–∑–¥–∞–Ω–∏–µ–º
   - –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
   - –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ –ø–∞–º—è—Ç—å—é

4. **BitmaskRingBufferMinimal<T>** - –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –≤–µ—Ä—Å–∏—è
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Unsafe –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
   - –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ thread safety

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **BitmaskRingBuffer<T>** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—É–ª–∞
2. **Task** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞–¥–∞—á
3. **HeavyTask** - —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ —Å payload
4. **ObjectPool<T>** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—É–ª–∞ –æ–±—ä–µ–∫—Ç–æ–≤
5. **ThreadSafetyAnalysis** - –∞–Ω–∞–ª–∏–∑ thread safety

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```
BitmaskRingBuffer:
‚îú‚îÄ‚îÄ AtomicReferenceArray<T> objects     # –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
‚îú‚îÄ‚îÄ long[] availabilityMask             # –ë–∏—Ç–æ–≤—ã–µ –º–∞—Å–∫–∏ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ (64 –±–∏—Ç–∞/–º–∞—Å–∫–∞)
‚îú‚îÄ‚îÄ long[] updateMask                   # –ë–∏—Ç–æ–≤—ã–µ –º–∞—Å–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ AtomicLong head                     # –ü–æ–∑–∏—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ AtomicLong tail                     # –ü–æ–∑–∏—Ü–∏—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞
‚îú‚îÄ‚îÄ AtomicLong occupiedCount            # –°—á–µ—Ç—á–∏–∫ –∑–∞–Ω—è—Ç—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
‚îî‚îÄ‚îÄ long[] lastUsedTimes               # –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ (getFreeObject)**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ head/tail
   - CAS-–æ–ø–µ—Ä–∞—Ü–∏—è –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏—Ç–∞ –≤ availabilityMask
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

2. **–í–æ–∑–≤—Ä–∞—Ç –æ–±—ä–µ–∫—Ç–∞ (setFreeObject)**:
   - –ü–æ–∏—Å–∫ –∏–Ω–¥–µ–∫—Å–∞ –æ–±—ä–µ–∫—Ç–∞
   - –°–±—Ä–æ—Å –±–∏—Ç–∞ –≤ availabilityMask
   - –£–≤–µ–ª–∏—á–µ–Ω–∏–µ tail

3. **–ë–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
   - 64 –±–∏—Ç–∞ –Ω–∞ long –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   - –ë—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ AND/OR –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏/—Å–±—Ä–æ—Å–∞ –±–∏—Ç–æ–≤

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ (5 –º–∏–Ω—É—Ç –Ω–∞–≥—Ä—É–∑–∫–∏)

#### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
| –ú–µ—Ç—Ä–∏–∫–∞ | UltraVarHandle | Classic | ClassicPreallocated | Minimal |
|---------|----------------|---------|-------------------|---------|
| –û–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫ | 3,124,342 | 3,017,853 | 3,089,123 | 3,156,789 |
| –í—Ä–µ–º—è acquire (–Ω—Å) | 412 | 521 | 478 | 389 |
| –í—Ä–µ–º—è release (–Ω—Å) | 532 | 439 | 456 | 523 |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ GC | **0** | 433 | 12 | 45 |
| –í—Ä–µ–º—è GC (–º—Å) | **0** | 218 | 8 | 23 |

#### Thread Safety —Ä–µ–π—Ç–∏–Ω–≥
1. **UltraVarHandle** - –û—Ç–ª–∏—á–Ω–æ (lock-free, –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
2. **Classic (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π)** - –•–æ—Ä–æ—à–æ (–∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
3. **Minimal** - –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ (–Ω–µ–∞—Ç–æ–º–∞—Ä–Ω—ã–µ –±–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
4. **ClassicPreallocated** - –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ (race conditions)

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

- **–ü–æ–ª—É—á–µ–Ω–∏–µ/–≤–æ–∑–≤—Ä–∞—Ç –æ–±—ä–µ–∫—Ç–∞**: ~400-500 –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥
- **–ü–∞–º—è—Ç—å –Ω–∞ –æ–±—ä–µ–∫—Ç**: ~8 –±–∞–π—Ç (—Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∞ + –±–∏—Ç–æ–≤—ã–µ –º–∞—Å–∫–∏)
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–∏–Ω–µ–π–Ω–∞—è –¥–æ 16+ –ø–æ—Ç–æ–∫–æ–≤
- **–ï–º–∫–æ—Å—Ç—å**: –î–æ 10-15 —Ç—ã—Å—è—á –æ–±—ä–µ–∫—Ç–æ–≤ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **Lock-free –∞–ª–≥–æ—Ä–∏—Ç–º—ã**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
2. **–ë–∏—Ç–æ–≤—ã–µ –º–∞—Å–∫–∏**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
3. **–ö–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä**: –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –ø–æ –∏–Ω–¥–µ–∫—Å—É
4. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤**: –ò–∑–±–µ–∂–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
5. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—É–∑—ã –ø—Ä–∏ –æ–∂–∏–¥–∞–Ω–∏–∏
6. **VarHandle**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```java
// –°–æ–∑–¥–∞–Ω–∏–µ –ø—É–ª–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è UltraVarHandle)
BitmaskRingBufferUltraVarHandle<Task> pool = new BitmaskRingBufferUltraVarHandle<>(
    16384, 
    () -> new ProcessTask("MyProcess")
);

// –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
Task task = pool.getFreeObject();
if (task != null) {
    task.start();
    // ... —Ä–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–µ–π ...
    task.stop();
    pool.setFreeObject(task);
}
```

### –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```java
ExecutorService executor = Executors.newFixedThreadPool(8);
for (int i = 0; i < 1000; i++) {
    executor.submit(() -> {
        Task task = pool.getFreeObject();
        if (task != null) {
            try {
                task.start();
                // ... —Ä–∞–±–æ—Ç–∞ ...
            } finally {
                task.stop();
                pool.setFreeObject(task);
            }
        }
    });
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ObjectPool –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

```java
// –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ –ø—É–ª–∞
ObjectPool<Task> pool = new BitmaskRingBufferClassic<>(
    () -> new ProcessTask("MyProcess"),
    1000,  // minSize
    10000, // maxSize
    1000   // timeoutMs
);

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç
Task task = pool.acquire();
if (task != null) {
    try {
        // —Ä–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–µ–π
    } finally {
        pool.release(task);
    }
}

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
ObjectPool.PoolStatistics stats = pool.getStatistics();
System.out.println("Utilization: " + 
    (double) stats.activeObjects / stats.maxPoolSize * 100 + "%");
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ GC

```bash
# –¢–µ—Å—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è GC (5 –º–∏–Ω—É—Ç)
java -cp "src/main/java" -Xmx2g -XX:+UseG1GC com.ultrafast.pool.GCMemoryTest

# –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
java -cp "src/main/java" com.ultrafast.pool.GCMemoryAnalysis
```

### –ê–Ω–∞–ª–∏–∑ thread safety

```bash
# –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ thread safety –≤—Å–µ—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
java -cp "src/main/java" com.ultrafast.pool.ThreadSafetyAnalysis
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –ø—É–ª–æ–≤

```bash
# –¢–µ—Å—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ –ø—É–ª–æ–≤
java -cp "src/main/java" com.ultrafast.pool.PoolSizeComparison
```

### –ê–Ω–∞–ª–∏–∑ –ø–∞–º—è—Ç–∏

```bash
# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
java -cp "src/main/java" com.ultrafast.pool.MemoryBenchmark
```

## API

### BitmaskRingBufferUltraVarHandle<T>

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

- `T getFreeObject()` - –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–π –æ–±—ä–µ–∫—Ç
- `boolean setFreeObject(T object)` - –≤–µ—Ä–Ω—É—Ç—å –æ–±—ä–µ–∫—Ç
- `T[] getOccupiedObjects()` - —Å–ø–∏—Å–æ–∫ –∑–∞–Ω—è—Ç—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- `T[] findStaleObjects(long maxAgeMs)` - –ø–æ–∏—Å–∫ –∑–∞–≤–∏—Å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- `void markAllForUpdate()` - –ø–æ–º–µ—Ç–∏—Ç—å –≤—Å–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `void stopAllOccupied()` - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–Ω—è—Ç—ã–µ –æ–±—ä–µ–∫—Ç—ã

### ObjectPool<T>

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

- `T acquire()` - –ø–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º
- `T acquire(long timeout, TimeUnit unit)` - –ø–æ–ª—É—á–∏—Ç—å —Å —Ç–∞–π–º–∞—É—Ç–æ–º
- `void release(T object)` - –≤–µ—Ä–Ω—É—Ç—å –æ–±—ä–µ–∫—Ç
- `PoolStatistics getStatistics()` - –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```java
public static class PoolStatistics {
    public final int maxPoolSize;        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞
    public final int availableObjects;   // –î–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
    public final int borrowedObjects;    // –í—ã–¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
    public final long totalAcquires;     // –í—Å–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏–π
    public final long totalReleases;     // –í—Å–µ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
    public final long totalCreates;      // –í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–∏–π
    public final long totalWaits;        // –í—Å–µ–≥–æ –æ–∂–∏–¥–∞–Ω–∏–π
    public final int activeObjects;      // –ê–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
}
```

### Task

#### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```java
public interface Task {
    long getId();                    // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
    void start();                    // –ó–∞–ø—É—Å–∫
    void stop();                     // –û—Å—Ç–∞–Ω–æ–≤–∫–∞
    boolean isRunning();             // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    boolean needsUpdate();           // –¢—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    void markForUpdate();            // –ü–æ–º–µ—Ç–∏—Ç—å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    long getLastUsedTime();          // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    String getStatus();              // –°—Ç–∞—Ç—É—Å –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏
}
```

## –°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–±–æ—Ä–∫–∞

```bash
mvn clean compile
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
mvn test
```

### –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤

```bash
mvn exec:java -Dexec.mainClass="org.openjdk.jmh.Main" -Dexec.args="BitmaskRingBufferBenchmark"
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Java 17+
- Maven 3.6+

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –î–ª—è —Å–∏—Å—Ç–µ–º —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- **UltraVarHandle** - –Ω—É–ª–µ–≤—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã GC, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –î–ª—è —Å–∏—Å—Ç–µ–º —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é
- **Classic** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ, –º–µ–Ω—å—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

### –î–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- **UltraVarHandle** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

### –î–ª—è —Å–∏—Å—Ç–µ–º —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π
- **Classic** - –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

CLI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å—à–∏–µ –æ–±—ä–µ–∫—Ç—ã –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –∏ –≤—ã–≤–æ–¥–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è.

### –†—É—á–Ω–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```java
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
PoolStatistics stats = pool.getStatistics();
System.out.println("Utilization: " + 
    (double) stats.activeObjects / stats.maxPoolSize * 100 + "%");

// –ü–æ–∏—Å–∫ –∑–∞–≤–∏—Å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
Task[] stale = pool.findStaleObjects(60000); // —Å—Ç–∞—Ä—à–µ 1 –º–∏–Ω—É—Ç—ã
System.out.println("Stale objects: " + stale.length);
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Thread-safe**: –ü–æ–ª–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ
- **Lock-free**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ deadlock'–æ–≤
- **Memory-efficient**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- **Graceful degradation**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏
- **Atomic operations**: –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race conditions

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License 